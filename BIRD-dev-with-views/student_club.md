6 views

```sql
CREATE VIEW vw_event_overview AS SELECT e.event_id, e.event_name, e.event_date, e.type, e.location, e.status AS event_status_current, e.notes, IFNULL(b.budgets_count, 0) AS budgets_count, IFNULL(b.budget_total_amount, 0) AS budget_total_amount, IFNULL(b.budget_total_spent, 0) AS budget_total_spent, IFNULL(b.budget_total_remaining, 0) AS budget_total_remaining, IFNULL(ex.expenses_count, 0) AS expenses_count, IFNULL(ex.expense_total_cost, 0.0) AS expense_total_cost, IFNULL(ex.approved_expense_total_cost, 0.0) AS approved_expense_total_cost, IFNULL(ex.unapproved_expense_total_cost, 0.0) AS unapproved_expense_total_cost, IFNULL(a.attendees_count, 0) AS attendees_count, CASE WHEN IFNULL(b.budget_total_remaining, 0) < 0 OR IFNULL(ex.expense_total_cost, 0) > IFNULL(b.budget_total_amount, 0) THEN 1 ELSE 0 END AS is_over_budget FROM event e LEFT JOIN ( SELECT link_to_event AS event_id, COUNT(*) AS budgets_count, SUM(amount) AS budget_total_amount, SUM(spent) AS budget_total_spent, SUM(remaining) AS budget_total_remaining FROM budget GROUP BY link_to_event ) b ON b.event_id = e.event_id LEFT JOIN ( SELECT b.link_to_event AS event_id, COUNT(DISTINCT e2.expense_id) AS expenses_count, SUM(e2.cost) AS expense_total_cost, SUM(CASE WHEN e2.approved = 'true' THEN e2.cost ELSE 0 END) AS approved_expense_total_cost, SUM(CASE WHEN e2.approved = 'false' THEN e2.cost ELSE 0 END) AS unapproved_expense_total_cost FROM budget b LEFT JOIN expense e2 ON e2.link_to_budget = b.budget_id GROUP BY b.link_to_event ) ex ON ex.event_id = e.event_id LEFT JOIN ( SELECT link_to_event AS event_id, COUNT(DISTINCT link_to_member) AS attendees_count FROM attendance GROUP BY link_to_event ) a ON a.event_id = e.event_id;


CREATE VIEW vw_budget_detail AS SELECT b.budget_id, b.category, b.amount, b.spent, b.remaining, b.event_status AS budget_event_status, b.link_to_event, e.event_id, e.event_name, e.event_date, e.type AS event_type, e.location AS event_location, e.status AS event_status_current, IFNULL(ex.expense_count, 0) AS expense_count, IFNULL(ex.expense_total_cost, 0.0) AS expense_total_cost, IFNULL(ex.approved_expense_total_cost, 0.0) AS approved_expense_total_cost, IFNULL(ex.unapproved_expense_total_cost, 0.0) AS unapproved_expense_total_cost, (b.amount - IFNULL(ex.expense_total_cost, 0.0)) AS remaining_from_expenses, CASE WHEN b.remaining < 0 OR IFNULL(ex.expense_total_cost, 0.0) > IFNULL(b.amount, 0) THEN 1 ELSE 0 END AS is_over_budget FROM budget b LEFT JOIN event e ON e.event_id = b.link_to_event LEFT JOIN ( SELECT e2.link_to_budget AS budget_id, COUNT(*) AS expense_count, SUM(e2.cost) AS expense_total_cost, SUM(CASE WHEN e2.approved = 'true' THEN e2.cost ELSE 0 END) AS approved_expense_total_cost, SUM(CASE WHEN e2.approved = 'false' THEN e2.cost ELSE 0 END) AS unapproved_expense_total_cost FROM expense e2 GROUP BY e2.link_to_budget ) ex ON ex.budget_id = b.budget_id;


CREATE VIEW vw_expense_detail AS SELECT e.expense_id, e.expense_description, e.expense_date, e.cost, e.approved, e.link_to_member, e.link_to_budget, m.member_id, m.first_name, m.last_name, (COALESCE(m.first_name, '') || CASE WHEN m.first_name IS NOT NULL AND m.last_name IS NOT NULL THEN ' ' ELSE '' END || COALESCE(m.last_name, '')) AS member_full_name, m.email, m.position, m.t_shirt_size, m.phone, m.zip, m.link_to_major, maj.major_name, maj.department, maj.college, z.type AS zip_type, z.city, z.county, z.state, z.short_state, b.budget_id, b.category AS budget_category, b.amount AS budget_amount, b.spent AS budget_spent, b.remaining AS budget_remaining, b.event_status AS budget_event_status, ev.event_id, ev.event_name, ev.event_date, ev.type AS event_type, ev.location AS event_location, ev.status AS event_status_current, ev.notes AS event_notes FROM expense e LEFT JOIN member m ON m.member_id = e.link_to_member LEFT JOIN major maj ON maj.major_id = m.link_to_major LEFT JOIN zip_code z ON z.zip_code = m.zip LEFT JOIN budget b ON b.budget_id = e.link_to_budget LEFT JOIN event ev ON ev.event_id = b.link_to_event;


CREATE VIEW vw_member_profile AS SELECT m.member_id, m.first_name, m.last_name, (COALESCE(m.first_name, '') || CASE WHEN m.first_name IS NOT NULL AND m.last_name IS NOT NULL THEN ' ' ELSE '' END || COALESCE(m.last_name, '')) AS full_name, m.email, m.position, m.t_shirt_size, m.phone, m.zip, m.link_to_major, maj.major_name, maj.department, maj.college, z.type AS zip_type, z.city, z.county, z.state, z.short_state, IFNULL(att.attendance_count, 0) AS attendance_count, la.last_attended_event_date, IFNULL(exp.expenses_count, 0) AS expenses_count, IFNULL(exp.expenses_total_cost, 0.0) AS expenses_total_cost, IFNULL(exp.approved_expenses_total_cost, 0.0) AS approved_expenses_total_cost, IFNULL(inc.incomes_count, 0) AS incomes_count, IFNULL(inc.income_total_amount, 0) AS income_total_amount FROM member m LEFT JOIN major maj ON maj.major_id = m.link_to_major LEFT JOIN zip_code z ON z.zip_code = m.zip LEFT JOIN ( SELECT link_to_member AS member_id, COUNT(*) AS attendance_count FROM attendance GROUP BY link_to_member ) att ON att.member_id = m.member_id LEFT JOIN ( SELECT a.link_to_member AS member_id, MAX(e.event_date) AS last_attended_event_date FROM attendance a LEFT JOIN event e ON e.event_id = a.link_to_event GROUP BY a.link_to_member ) la ON la.member_id = m.member_id LEFT JOIN ( SELECT link_to_member AS member_id, COUNT(*) AS expenses_count, SUM(cost) AS expenses_total_cost, SUM(CASE WHEN approved = 'true' THEN cost ELSE 0 END) AS approved_expenses_total_cost FROM expense GROUP BY link_to_member ) exp ON exp.member_id = m.member_id LEFT JOIN ( SELECT link_to_member AS member_id, COUNT(*) AS incomes_count, SUM(amount) AS income_total_amount FROM income GROUP BY link_to_member ) inc ON inc.member_id = m.member_id;


CREATE VIEW vw_attendance_detail AS SELECT a.link_to_event, a.link_to_member, e.event_id, e.event_name, e.event_date, e.type AS event_type, e.location AS event_location, e.status AS event_status_current, e.notes AS event_notes, m.member_id, m.first_name, m.last_name, (COALESCE(m.first_name, '') || CASE WHEN m.first_name IS NOT NULL AND m.last_name IS NOT NULL THEN ' ' ELSE '' END || COALESCE(m.last_name, '')) AS member_full_name, m.email, m.position, m.t_shirt_size, m.phone, m.zip, m.link_to_major, maj.major_name, maj.department, maj.college, z.type AS zip_type, z.city, z.county, z.state, z.short_state FROM attendance a LEFT JOIN event e ON e.event_id = a.link_to_event LEFT JOIN member m ON m.member_id = a.link_to_member LEFT JOIN major maj ON maj.major_id = m.link_to_major LEFT JOIN zip_code z ON z.zip_code = m.zip;


CREATE VIEW vw_income_detail AS SELECT i.income_id, i.date_received, i.amount, i.source, i.notes, i.link_to_member, m.member_id, m.first_name, m.last_name, (COALESCE(m.first_name, '') || CASE WHEN m.first_name IS NOT NULL AND m.last_name IS NOT NULL THEN ' ' ELSE '' END || COALESCE(m.last_name, '')) AS member_full_name, m.email, m.position, m.t_shirt_size, m.phone, m.zip, m.link_to_major, maj.major_name, maj.department, maj.college, z.type AS zip_type, z.city, z.county, z.state, z.short_state FROM income i LEFT JOIN member m ON m.member_id = i.link_to_member LEFT JOIN major maj ON maj.major_id = m.link_to_major LEFT JOIN zip_code z ON z.zip_code = m.zip;

```
